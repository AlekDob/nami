---
type: diary
project: namios
date: 2026-02-09
---

# 2026-02-09

## macOS Critical Debugging Session

### Bugs Fixed
1. **ViewBridge crash on macOS launch** — Missing `NSApplicationDelegateAdaptor`. App crashed with `ViewBridge to RemoteViewService Terminated: Code=18` because macOS had no lifecycle delegate. Fixed by creating `MacAppDelegate: NSApplicationDelegate` and attaching with `@NSApplicationDelegateAdaptor`. See `bugs/fix-macos-viewbridge-crash-missing-appdelegate.md`

2. **macOS APNs not registering** — `registerForRemoteNotifications()` only called `UIApplication.shared` which doesn't exist on macOS. Added platform-specific call to `NSApplication.shared.registerForRemoteNotifications()` with `#if canImport(AppKit)`. See `bugs/fix-macos-apns-registration-appkit.md`

3. **99% CPU infinite loop on macOS** — `ChatView` accessed `viewModel.tts.audioLevel` in body → created subscription → entire chat (50+ messages, markdown parsing) re-rendered at 30fps when audio level updated. Isolated to child view `ChatHeaderNami` that only passes reference, not access property. 99% CPU dropped to <5%. See `bugs/fix-macos-99-percent-cpu-observable-cascade.md`

### Patterns Documented
- **iOS push notification race condition** — APNs token callback can arrive before `pushManager` assigned. Use `didSet` observer to flush pending token. See `patterns/pattern-ios-push-notification-race-condition.md`

### Gotchas Documented
- **@Observable cascade re-renders** — Accessing `@Observable` properties in parent body creates subscriptions that re-render entire hierarchy. Move property access to small child views. See `gotchas/gotcha-observable-cascade-rerender.md`

### Key Insights
- **Multi-platform delegates**: Use `@UIApplicationDelegateAdaptor` for iOS, `@NSApplicationDelegateAdaptor` for macOS. Never assume one platform's API exists on another.
- **@Observable subscription model**: Views subscribe only through direct property access in body. Parent views don't subscribe if they only pass references.
- **Re-render isolation**: Frequently-updating properties should be accessed only in small, focused child views. This bounds re-render cascades.

### Status
macOS app now launches successfully, APNs registration works, and CPU usage is normal. All critical stability issues resolved. Ready for testing on macOS 14+ devices.
