---
type: diary
project: namios
date: 2026-02-12
---

# 2026-02-12

## MCP Server Integration & Debugging Session

### Part 1: File Permissions & SwiftUI Access
- Fixed file read/write access across SwiftUI app, CLI, and backend
- Implemented `file-read` and `file-write` tools with proper permission handling
- Documented at `bugs/fix-file-read-write-permission-denied-swiftui.md`

### Part 2: MCP Server Connection Fixes

#### Bugs Fixed
1. **MCP Loader limited to HTTP transport only** — `src/mcp/loader.ts` only supported `StreamableHTTPClientTransport`. Command-based MCP servers (stdio/stdin) like Mixpanel couldn't connect. Extended loader with `StdioClientTransport` support and union type `McpServerConfig`. See `bugs/fix-mcp-loader-stdio-transport-missing.md`

2. **Mixpanel MCP token configuration error** — Server expects CLI arg `--token <value>`, not env var. Also used wrong command (`bun -y` instead of `npx -y`). Fixed `.mcp.json` config to pass token via args. Verified with stdio test: `printf {...} | npx -y mixpanel-mcp-server --token <TOKEN>`. See `gotchas/gotcha-mcp-mixpanel-token-cli-arg.md`

3. **PostHog MCP API key invalid** — Cloudflare 1101 Worker exception revealed invalid API key `phx_leg8...`. curl test showed `authentication_failed`. Switched to primary key from Obsidian vault. Verified: PostHog returned valid MCP initialize response. Updated `.env`.

#### Gotchas Documented
- **MCP configuration pattern differences** — HTTP servers use `type: "http"`, `url`, `headers` (with `${ENV_VAR}` support). Command servers use `type: "command"`, `command`, `args[]`. Easy to miss silent failures — MCP servers log to stdout but don't crash the app. See `gotchas/gotcha-mcp-configuration-patterns-http-vs-stdio.md`

#### Patterns Documented
- **MCP server testing strategy** — HTTP: use curl with Authorization header. Stdio: use printf + pipe to command. Both test JSON-RPC 2.0 protocol. See `patterns/pattern-mcp-server-testing-http-stdio.md`

### MCP Servers Now Active
- **PostHog** (HTTP): analytics queries, docs search, resources
- **Mixpanel** (stdio): event tracking, pageview tracking, user signups

### Technical Details
- MCP SDK: `@modelcontextprotocol/sdk@1.26.0`
- Transports: `StreamableHTTPClientTransport`, `StdioClientTransport`
- Service logs: `[MCP] mixpanel connected` + `[MCP] posthog connected`

### Files Modified
| File | Change |
|------|--------|
| `/root/meow/src/mcp/loader.ts` | Added stdio transport support |
| `/root/meow/.mcp.json` | Fixed Mixpanel args: `--token` CLI arg |
| `/root/meow/.env` | Updated PostHog API key |

### Key Insights
- **Silent MCP failures**: Check stdout logs during development — connection errors don't crash the service
- **CLI arg vs env var**: Some MCP servers are strict about how they receive secrets (e.g., Mixpanel). Test with stdio command directly before integrating.
- **Transport testing**: Verify HTTP MCP servers with curl first, stdio with printf + pipe. Confirms protocol works before adding to loader.

### Status
Both MCP servers connected successfully. Ready for agent tool integration and analytics tracking.

---

## Part 3: Raycast-Style Quick Input for macOS

Designed and documented **Quick Input** feature — a global keyboard shortcut to send messages without switching app context.

### Implementation Details
- **Hotkey**: ⌘⇧N (Cmd + Shift + N), customizable via Settings
- **UI**: Floating `NSPanel` with blur background, 400px width, positioned near cursor
- **Architecture**: `GlobalHotkeyManager` (NSEvent), `QuickInputPanel` (NSPanel), `QuickInputView` (SwiftUI)
- **IPC**: NotificationCenter (`.quickInputSend`) to decouple QuickInput from ChatViewModel
- **Menu Bar**: SwiftUI `MenuBarExtra` for persistent presence
- **Permissions**: Accessibility (AXIsProcessTrusted) for global hotkey detection

### Files Created
- `Sources/Core/QuickInput/GlobalHotkeyManager.swift` — Hotkey detection + manager
- `Sources/Core/QuickInput/QuickInputPanel.swift` — NSPanel subclass with NSHostingView
- `Sources/Core/QuickInput/QuickInputView.swift` — Input field + send button
- `Sources/Core/QuickInput/HotkeyRecorderView.swift` — Settings UI for custom shortcuts

### Design Decisions
1. **NSEvent.addGlobalMonitorForEvents over CGEventTap** — No Input Monitoring permission needed
2. **NSPanel.nonactivatingPanel** — Doesn't steal focus from active app
3. **Recreate panel on each invocation** — Avoids stale SwiftUI state in NSHostingView
4. **MenuBarExtra over NSStatusItem** — Native macOS 13+ SwiftUI API

### Key Gotchas Discovered
- `NSEvent` hotkey monitoring requires Accessibility permission (prompted on first use)
- `applicationShouldTerminateAfterLastWindowClosed = false` needed for menu bar persistence
- NSHostingView + SwiftUI state can become stale; panel recreation solves this
- NotificationCenter avoids self-capture issues in App struct

### Decision Document
Saved to `decisions/decision-raycast-quick-input-macos.md` with full architecture, gotchas, and trade-offs.
